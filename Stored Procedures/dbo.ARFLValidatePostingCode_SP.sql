SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO










 



					 










































 








































































































































































































































































































































































































































































































CREATE PROCEDURE [dbo].[ARFLValidatePostingCode_SP](	@batch_ctrl_num 	varchar( 16 ),
							@debug_level		smallint = 0,
							@perf_level		smallint = 0	)
AS






DECLARE
 @PERF_time_last datetime

SELECT @PERF_time_last = GETDATE()















									







DECLARE
	@result			int,
	@err_count			int
	

IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, "tmp/arflvpc.sp", 59, "ARFLValidatePostingCode_SP", @PERF_time_last OUTPUT

BEGIN
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arflvpc.sp" + ", line " + STR( 62, 5 ) + " -- ENTRY: "
	
	UPDATE	#artrx_work
	SET	temp_flag = 0
	
	UPDATE	#artrx_work
	SET	temp_flag = 1
	FROM	araccts acct, #artrx_work trx
	WHERE	acct.posting_code = trx.posting_code
	
	INSERT	#ewerror
	(	module_id, 					err_code,		
		info1,			info2,			infoint,
		infofloat,		flag1,			trx_ctrl_num,
		sequence_id,		source_ctrl_num,	extra
	)
	SELECT 2000,			20851,
		posting_code,		"",			0,
		0.0,			1,		trx_ctrl_num,
		0,			"",			0				
	FROM	#artrx_work
	WHERE	temp_flag = 0

	IF( @@error != 0 )
		RETURN 34563

	IF( @debug_level >= 3 )
	BEGIN
		SELECT	@err_count = count(*)
		FROM	#ewerror
		WHERE	err_code = 20851
		IF ( @debug_level > 3 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arflvpc.sp" + ", line " + STR( 93, 5 ) + " -- MSG: " + "Number of bad posting_code = " + STR(@err_count, 7)
	END
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arflvpc.sp" + ", line " + STR( 95, 5 ) + " -- EXIT: "
	RETURN 0
END
GO
GRANT EXECUTE ON  [dbo].[ARFLValidatePostingCode_SP] TO [public]
GO
