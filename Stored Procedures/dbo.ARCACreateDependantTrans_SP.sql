SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO










 



					 










































 






















































































































































































































































































































































































































































































































 
















































































CREATE PROC [dbo].[ARCACreateDependantTrans_SP]	@batch_ctrl_num	varchar(16),
						@debug_level		smallint,
						@perf_level		smallint

AS






DECLARE
 @PERF_time_last datetime

SELECT @PERF_time_last = GETDATE()















									






											 
DECLARE
	@result	int,
	@cm_if		smallint,	 
	@cm_trx_rqrd	smallint	 

IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, "tmp/arcacdt.sp", 48, "Entering ARCACreateDependantTrans_SP", @PERF_time_last OUTPUT

BEGIN
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arcacdt.sp" + ", line " + STR( 51, 5 ) + " -- ENTRY: "

	EXEC @result = ARCACreateGLTrans_SP	@batch_ctrl_num,
							@debug_level,
							@perf_level

	IF(@result != 0)
	BEGIN
		IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arcacdt.sp" + ", line " + STR( 59, 5 ) + " -- EXIT: "
		RETURN @result
	END

	
	SELECT	@cm_if = bb_flag,
		@cm_trx_rqrd = 0
	FROM	arco

	SELECT	@cm_trx_rqrd = count(*)
	FROM	#arinppyt_work
	WHERE	payment_type = 1
	AND	trx_type >= 2113 
	AND	trx_type <= 2121
	AND	void_type < 4		

	IF (@cm_if = 1 AND @cm_trx_rqrd > 0)
	BEGIN

		EXEC @result = ARCACreateCMtrans_SP	@batch_ctrl_num,
								@debug_level,
								@perf_level

		IF(@result != 0)
		BEGIN
			IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arcacdt.sp" + ", line " + STR( 89, 5 ) + " -- EXIT: "
			RETURN @result
		END
	END


	IF EXISTS (	SELECT	* 
			FROM 	#arinppyt_work 
			WHERE	batch_code = @batch_ctrl_num
			AND	trx_type = 2113
			AND	void_type = 4 
			)
	BEGIN
		EXEC @result = ARCACreateCashReceipt_SP	@batch_ctrl_num,
								@debug_level,
								@perf_level

		IF(@result != 0)
		BEGIN
			IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arcacdt.sp" + ", line " + STR( 111, 5 ) + " -- EXIT: "
			RETURN @result
		END
	END
	
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arcacdt.sp" + ", line " + STR( 116, 5 ) + " -- EXIT: "
	IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, "tmp/arcacdt.sp", 117, "Leaving ARCAPostTemp_SP", @PERF_time_last OUTPUT
	RETURN 0 

END
GO
GRANT EXECUTE ON  [dbo].[ARCACreateDependantTrans_SP] TO [public]
GO
