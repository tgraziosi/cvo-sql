SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO


























  



					  

























































 

























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                       










































CREATE PROC [dbo].[ARCRCreateCMtrans_SP]	 @batch_ctrl_num    	varchar(16),
					 @debug_level		smallint,
					 @perf_level		smallint

AS








DECLARE
        @PERF_time_last     datetime

SELECT  @PERF_time_last = GETDATE()

















									






											  
DECLARE
	@result		int,
@last_deposit_num	varchar(16),
	@deposit_num		varchar(16),
	@payment_code		varchar(8),
	@description		varchar(40),
	@cash_acct_code	varchar(32),
	@deposit_amount	float,
	@date_applied		int,
	@org_id		varchar(30)


IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, 'arcrccm.cpp', 67, 'Entering ARCRCreateCMtrans_SP', @PERF_time_last OUTPUT

BEGIN
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcrccm.cpp' + ', line ' + STR( 70, 5 ) + ' -- ENTRY: '

	SELECT @last_deposit_num = ' '

	WHILE ( 1 = 1 )
	


	BEGIN
		SELECT @deposit_num = NULL

        	SELECT	@deposit_num = MIN(deposit_num)
        	FROM 	#ardepnum
		WHERE	deposit_num > @last_deposit_num
	 	IF( @@error != 0 )
		BEGIN
			IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcrccm.cpp' + ', line ' + STR( 86, 5 ) + ' -- EXIT: '
			RETURN 34563
		END
		
        	SELECT	@deposit_amount = dep.deposit_amount,
			@date_applied = dep.date_applied,
			@description = meth.description,
			@cash_acct_code = dep.cash_acct_code,
			@org_id	 = dep.org_id
		FROM 	#ardepnum dep, arpymeth meth
 		WHERE	deposit_num = @deposit_num
		AND	dep.payment_code = meth.payment_code
     
       	IF( @@error != 0 )
		BEGIN
			IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcrccm.cpp' + ', line ' + STR( 101, 5 ) + ' -- EXIT: '
			RETURN 34563
		END


		


		IF ( @deposit_num IS NULL )
		BEGIN
			IF ( @debug_level > 2 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcrccm.cpp' + ', line ' + STR( 111, 5 ) + ' -- MSG: ' + 'CM transactions created'
			BREAK
		END
		

		SELECT @last_deposit_num = @deposit_num

		EXEC @result = cminpcr_sp		2000,
							2,
							2111,
							@deposit_num,
							@deposit_num,
							@date_applied,
							@description,
							' ',		
							' ',   	
							@cash_acct_code,
							@deposit_amount,
							0,		
							@date_applied,
							NULL,	
							NULL,
							NULL,
							0,
							NULL,
							@org_id

		IF(@result != 0)
		BEGIN
			IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcrccm.cpp' + ', line ' + STR( 140, 5 ) + ' -- EXIT: '
			RETURN @result
		END
		
		IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcrccm.cpp' + ', line ' + STR( 144, 5 ) + ' -- EXIT: '
	END 

END 


GO
GRANT EXECUTE ON  [dbo].[ARCRCreateCMtrans_SP] TO [public]
GO
