SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO










 



					 










































 































































































































































































































































































































































































































































































































































































 








































































































































































































































































CREATE PROC [dbo].[arinvstx_sp]	@batch_ctrl_num	varchar( 16 ),
				@debug_level		smallint = 0,
				@perf_level		smallint = 0
AS






DECLARE
 @PERF_time_last datetime

SELECT @PERF_time_last = GETDATE()















									







DECLARE 
	@float_holder 	float, 
	@result 		int, 
	@company_id 		smallint, 
	@cmp_result 		smallint, 
	@payer_cust_code	varchar( 8 )

IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, "tmp/arinvstx.sp", 65, "Entering arinvstx_sp", @PERF_time_last OUTPUT

BEGIN
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arinvstx.sp" + ", line " + STR( 68, 5 ) + " -- ENTRY: "

	
	SELECT	trx_ctrl_num, trx_type, age_count = COUNT(trx_ctrl_num)
	INTO	#age_count
	FROM	#arinpage_work
	GROUP BY trx_ctrl_num, trx_type
	IF( @@error != 0 )
	BEGIN
		IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arinvstx.sp" + ", line " + STR( 81, 5 ) + " -- EXIT: "
		RETURN 34563
	END
		
	UPDATE	#arinpchg_work
	SET	date_aging = 0
	FROM	#age_count ac, #arinpchg_work arinpchg
	WHERE	arinpchg.batch_code = @batch_ctrl_num
	AND	ac.trx_ctrl_num = arinpchg.trx_ctrl_num
	AND	ac.trx_type = arinpchg.trx_type
	AND	ac.age_count > 1
	IF( @@error != 0 )
	BEGIN
		IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arinvstx.sp" + ", line " + STR( 94, 5 ) + " -- EXIT: "
		RETURN 34563
	END
	
	DROP TABLE #age_count
	IF( @@error != 0 )
	BEGIN
		IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arinvstx.sp" + ", line " + STR( 101, 5 ) + " -- EXIT: "
		RETURN 34563
	END

	IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, "tmp/arinvstx.sp", 105, "Leaving arinvstx_sp", @PERF_time_last OUTPUT
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "tmp/arinvstx.sp" + ", line " + STR( 106, 5 ) + " -- EXIT: "
	RETURN 0
END		
GO
GRANT EXECUTE ON  [dbo].[arinvstx_sp] TO [public]
GO
