SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO

/*                                                      
               Confidential Information                  
    Limited Distribution of Authorized Persons Only       
    Created 2001 and Protected as Unpublished Work       
          Under the U.S. Copyright Act of 1976            
 Copyright (c) 2001 Epicor Software Corporation, 2001    
                  All Rights Reserved                    
*/                                                


































































































  



					  

























































 


















































































































































































































































































































                       








































CREATE  PROCEDURE [dbo].[batinfo_group_sp]
		@batch_code             varchar(16),
		@process_ctrl_num       varchar(16)   OUTPUT,
		@process_user_id        smallint                        OUTPUT,
		@process_date           int                             OUTPUT,
		@period_end             int                             OUTPUT,
		@batch_type             smallint                        OUTPUT

AS 
BEGIN
	DECLARE @start_date     datetime,
		@date_applied   int
	
	SELECT  @process_ctrl_num = NULL,
		@process_user_id  = NULL,
		@process_date     = NULL,
		@period_end       = NULL,
		@batch_type       = NULL
	
	SELECT  @process_ctrl_num = p.process_ctrl_num,
		@process_user_id = p.process_user_id,
		@start_date = p.process_start_date,
		@date_applied = b.date_applied,
		@batch_type = b.batch_type
	FROM batchctl b
		INNER JOIN #Group_batch GRP ON b.batch_ctrl_num = GRP.batch_ctrl_num AND GRP.batch_ctrl_num_group = @batch_code
		INNER JOIN pcontrol_vw p ON GRP.process_group_num = p.process_ctrl_num
	
	IF ( @process_ctrl_num IS NULL )
		RETURN  -1
	
	SELECT  @process_date = datediff(dd,"1/1/80",@start_date)+722815
	
	SELECT  @period_end = period_end_date
	FROM batchctl BAT
		INNER JOIN #Group_batch GRP ON BAT.batch_ctrl_num = GRP.batch_ctrl_num AND GRP.batch_ctrl_num_group = @batch_code
		INNER JOIN glprd PRD ON BAT.date_applied BETWEEN PRD.period_start_date AND PRD.period_end_date
	
	IF ( @period_end IS NULL )
	BEGIN
		SELECT  @process_ctrl_num = NULL
		RETURN -1
	END
	
	RETURN 0
END
/**/                                              
GO
GRANT EXECUTE ON  [dbo].[batinfo_group_sp] TO [public]
GO
