SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO


























  



					  

























































 











































































































































































































































































































































































































































































































































































































































































































CREATE PROC [dbo].[ARCACreateWROffdetails_SP]	@batch_ctrl_num     varchar( 16 ),
                                		@debug_level        smallint = 0,
                                		@perf_level         smallint = 0    
AS








DECLARE
        @PERF_time_last     datetime

SELECT  @PERF_time_last = GETDATE()

















									








IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, 'arcacwro.cpp', 52, 'Entering ARCACreateWROffdetails_SP', @PERF_time_last OUTPUT












BEGIN
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcacwro.cpp' + ', line ' + STR( 66, 5 ) + ' -- ENTRY: '


	



	INSERT	#argldist
	(
		date_applied,				account_code,		
		description,				document_1,
		document_2,				nat_balance,				
		nat_cur_code,				rate_type_home,			
		rate_type_oper,			rate_home,				
		rate_oper,				trx_type,				
		seq_ref_id,				trx_ctrl_num,
		org_id
	)
	SELECT	pyt.date_applied,			dbo.IBAcctMask_fn(acct.writeoff_account,trx.org_id),
		pyt.trx_desc,				pyt.customer_code,
		pyt.doc_ctrl_num,			-pdt.inv_amt_max_wr_off,			
		trx.nat_cur_code,			trx.rate_type_home,			
		trx.rate_type_oper,			trx.rate_home,			
		trx.rate_oper,			pyt.trx_type,				
		0,					pyt.trx_ctrl_num,
		trx.org_id									
	FROM	#arinppdt_work pdt, #arinppyt_work pyt, #artrx_work trx, arwrofac acct
	WHERE	pdt.trx_ctrl_num = pyt.trx_ctrl_num
	AND	pdt.sub_apply_num = trx.doc_ctrl_num
	AND	pdt.sub_apply_type = trx.trx_type
	AND	pdt.writeoff_code = acct.writeoff_code
	AND	pyt.batch_code = @batch_ctrl_num
	
	IF( @@error != 0 )
	BEGIN
		IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcacwro.cpp' + ', line ' + STR( 101, 5 ) + ' -- EXIT: '
		RETURN 34563
	END

IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + '  ' + 'arcacwro.cpp' + ', line ' + STR( 105, 5 ) + ' -- EXIT: '
IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, 'arcacwro.cpp', 106, 'Leaving ARCACreateWROffdetails_SP', @PERF_time_last OUTPUT
RETURN 0 

END

GO
GRANT EXECUTE ON  [dbo].[ARCACreateWROffdetails_SP] TO [public]
GO
