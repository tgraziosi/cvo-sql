SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO


























  



					  

























































 











































































































































































































































































































































































































































































































































































































































































































CREATE PROC [dbo].[ARCRCreateCashDetails_SP]  @batch_ctrl_num     varchar( 16 ),
                                			@debug_level        smallint = 0,
                                			@perf_level         smallint = 0    
AS








DECLARE
        @PERF_time_last     datetime

SELECT  @PERF_time_last = GETDATE()

















									







DECLARE
    	@result             	int,
	@journal_type		varchar(8),
	@company_code		varchar(8),
	@home_currency   	varchar(8),
	@oper_currency	varchar(8),
	@reference_code   	varchar(8)

IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, "arcrccd.cpp", 65, "Entering ARCRCreateCashDetails_SP ", @PERF_time_last OUTPUT









BEGIN
	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "arcrccd.cpp" + ", line " + STR( 76, 5 ) + " -- ENTRY: "

	IF ( @debug_level > 0 )
	BEGIN
		SELECT "arinppyt_work before insert into argldist"
		SELECT doc_ctrl_num + "trx_type" + STR(trx_type) + customer_code
		FROM #arinppyt_work
		WHERE	batch_code = @batch_ctrl_num
	END

	


	INSERT	#argldist
	(
		date_applied,				account_code,		
		description,				document_1,
		document_2,				nat_balance,				
		nat_cur_code,				rate_type_home,			
		rate_type_oper,			rate_home,				
		rate_oper,				trx_type,				
		seq_ref_id,				trx_ctrl_num,
                org_id        	
	)
	SELECT
		date_applied,				 cash_acct_code,
		trx_desc,				customer_code,
		doc_ctrl_num,				amt_payment,
		nat_cur_code,				rate_type_home,
		rate_type_oper,			rate_home,
		rate_oper,				trx_type,
		0,					trx_ctrl_num,
                org_id        
	FROM	#arinppyt_work 
	WHERE	batch_code = @batch_ctrl_num
	AND	trx_type = 2111
	AND	payment_type = 1  	
	IF( @@error != 0 )
	BEGIN
		IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "arcrccd.cpp" + ", line " + STR( 115, 5 ) + " -- EXIT: "
		RETURN 34563
	END

	IF (@debug_level > 0)
		BEGIN
			SELECT "dumping argldist after Cash details are added"
			SELECT	"date_applied account code description document_1 document_2 nat_balance nat_cur_code"
			SELECT	STR(date_applied, 7) + ":" +
					account_code + ":" +
					description + ":" +
					document_1 + ":" +
					document_2 + ":" +
					STR(nat_balance, 10, 2 ) + ":" +
					nat_cur_code
			FROM	#argldist
	END

	IF ( @debug_level > 1 ) SELECT CONVERT(char,getdate(),109) + "  " + "arcrccd.cpp" + ", line " + STR( 133, 5 ) + " -- EXIT: "
	IF ( @perf_level >= 1 ) EXEC perf_sp @batch_ctrl_num, "arcrccd.cpp", 134, "Leaving ARCRCreateCashDetails_SP ", @PERF_time_last OUTPUT
    RETURN 0 

END

GO
GRANT EXECUTE ON  [dbo].[ARCRCreateCashDetails_SP] TO [public]
GO
