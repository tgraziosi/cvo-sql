SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO

/* PVCS Revision or Version:Revision              
I:\vcs\AP\PROCS\apvodel.SPv - e7.2.2 : 1.1
              Confidential Information                  
   Limited Distribution of Authorized Persons Only      
   Created 1996 and Protected as Unpublished Work       
         Under the U.S. Copyright Act of 1976           
Copyright (c) 1996 Epicor Software Corporation, 1996  
                 All Rights Reserved                    
*/                                                

 








 



					 










































 

















































































































































































































































































































































































































































































































































































 






























































CREATE PROCEDURE [dbo].[apvodel_sp] @trx_ctrl_num varchar(16), @debug smallint = 0
AS
DECLARE

		@vend_flag smallint,
		@pto_flag smallint,
		@cls_flag smallint,
		@bch_flag smallint



	SELECT @vend_flag = apactvnd_flag,
	@pto_flag = apactpto_flag,
	@cls_flag = apactcls_flag,
	@bch_flag = apactbch_flag
		FROM apco


BEGIN TRAN

DELETE apinpchg WHERE trx_ctrl_num = @trx_ctrl_num AND trx_type = 4091

DELETE apinpcdt WHERE trx_ctrl_num = @trx_ctrl_num AND trx_type = 4091

DELETE apinpage WHERE trx_ctrl_num = @trx_ctrl_num AND trx_type = 4091

DELETE apinptax WHERE trx_ctrl_num = @trx_ctrl_num AND trx_type = 4091

DELETE apinptmp WHERE trx_ctrl_num = @trx_ctrl_num AND trx_type = 4091

IF @vend_flag = 1
	UPDATE apactvnd
	SET amt_vouch_unposted = apactvnd.amt_vouch_unposted - b.amt_net
	FROM apactvnd, apinpchg b
	WHERE apactvnd.vendor_code = b.vendor_code
	AND b.trx_ctrl_num = @trx_ctrl_num
	AND b.trx_type = 4091

IF @pto_flag = 1
	UPDATE apactpto
	SET amt_vouch_unposted = apactpto.amt_vouch_unposted - b.amt_net
	FROM apactpto, apinpchg b
	WHERE apactpto.vendor_code = b.vendor_code
	AND apactpto.pay_to_code = b.pay_to_code
	AND b.trx_ctrl_num = @trx_ctrl_num
	AND b.trx_type = 4091

IF @bch_flag = 1
	UPDATE apactbch
	SET amt_vouch_unposted = apactbch.amt_vouch_unposted - b.amt_net
	FROM apactbch, apinpchg b
	WHERE apactbch.branch_code = b.branch_code
	AND b.trx_ctrl_num = @trx_ctrl_num
	AND b.trx_type = 4091

IF @cls_flag = 1
	UPDATE apactcls
	SET amt_vouch_unposted = apactcls.amt_vouch_unposted - b.amt_net
	FROM apactcls, apinpchg b
	WHERE apactcls.class_code = b.class_code
	AND b.trx_ctrl_num = @trx_ctrl_num
	AND b.trx_type = 4091


COMMIT TRAN


RETURN 0




/**/                                              
GO
GRANT EXECUTE ON  [dbo].[apvodel_sp] TO [public]
GO
